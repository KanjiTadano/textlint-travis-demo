{"version":3,"sources":["../src/rc-config-loader.js"],"names":["path","require","debug","requireUncached","JSON5","fs","pathExists","objectAssign","keys","emptyConfig","undefined","defaultLoaderByExt","loadJSConfigFile","loadJSONConfigFile","loadYAMLConfigFile","defaultOptions","packageJSON","defaultExtension","cwd","process","module","exports","rcConfigLoader","pkgName","opts","configFileName","packageJSONFieldName","fieldName","parts","splitPath","loaders","Array","isArray","map","extension","loaderByExt","findConfig","exts","length","ext","shift","configLocation","join","sync","loader","config","filePath","i","result","pkgJSONLoc","pkgJSON","pop","x","resolve","split","sep","filename","suppress","e","message","parse","readFile","readFileSync","yaml","safeLoad"],"mappings":"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","file":"rc-config-loader.js","sourcesContent":["// MIT © 2017 azu\n// MIT © Zoltan Kochan\n// Original https://github.com/zkochan/rcfile\n\"use strict\";\nconst path = require(\"path\");\nconst debug = require(\"debug\")(\"rc-config-loader\");\nconst requireUncached = require(\"require-uncached\");\nconst JSON5 = require(\"json5\");\nconst fs = require(\"fs\");\nconst pathExists = require(\"path-exists\");\nconst objectAssign = require(\"object-assign\");\nconst keys = require(\"object-keys\");\nconst emptyConfig = undefined;\n\nconst defaultLoaderByExt = {\n    \".js\": loadJSConfigFile,\n    \".json\": loadJSONConfigFile,\n    \".yaml\": loadYAMLConfigFile,\n    \".yml\": loadYAMLConfigFile,\n};\n\nconst defaultOptions = {\n    // does look for `package.json`\n    packageJSON: false,\n    // treat default(no ext file) as some extension\n    defaultExtension: \".json\",\n    cwd: process.cwd()\n};\n\n/**\n * @param {string} pkgName\n * @param {rcConfigLoaderOption} [opts]\n * @returns {object}\n */\nmodule.exports = function rcConfigLoader(pkgName, opts = {}) {\n    // path/to/config or basename of config file.\n    const configFileName = opts.configFileName || `.${pkgName}rc`;\n    const defaultExtension = opts.defaultExtension || defaultOptions.defaultExtension;\n    const cwd = opts.cwd || defaultOptions.cwd;\n    const packageJSON = opts.packageJSON || defaultOptions.packageJSON;\n    const packageJSONFieldName = typeof packageJSON === \"object\"\n        ? packageJSON.fieldName\n        : pkgName;\n\n    const parts = splitPath(cwd);\n\n    const loaders = Array.isArray(defaultExtension)\n        ? defaultExtension.map((extension) => defaultLoaderByExt[extension])\n        : defaultLoaderByExt[defaultExtension];\n\n    const loaderByExt = objectAssign({}, defaultLoaderByExt, {\n        \"\": loaders,\n    });\n\n    return findConfig(parts);\n\n    /**\n     * @returns {object} always return object\n     */\n    function findConfig() {\n        const exts = keys(loaderByExt);\n        while (exts.length) {\n            const ext = exts.shift();\n            const configLocation = join(parts, configFileName + ext);\n            if (!pathExists.sync(configLocation)) {\n                continue;\n            }\n            const loaders = loaderByExt[ext];\n            if (!Array.isArray(loaders)) {\n                const loader = loaders;\n                return {\n                    config: loader(configLocation),\n                    filePath: configLocation\n                };\n            }\n            for (let i = 0; i < loaders.length; i++) {\n                const loader = loaders[i];\n                const result = loader(configLocation, true);\n                if (result) {\n                    return {\n                        config: result,\n                        filePath: configLocation\n                    };\n                }\n            }\n        }\n\n        if (packageJSON) {\n            const pkgJSONLoc = join(parts, \"package.json\");\n            if (pathExists.sync(pkgJSONLoc)) {\n                const pkgJSON = require(pkgJSONLoc);\n                if (pkgJSON[packageJSONFieldName]) {\n                    return {\n                        config: pkgJSON[packageJSONFieldName],\n                        filePath: pkgJSONLoc\n                    };\n                }\n            }\n        }\n        if (parts.pop()) {\n            return findConfig();\n        }\n        return emptyConfig;\n    }\n};\n\nfunction splitPath(x) {\n    return path.resolve(x || \"\").split(path.sep);\n}\n\nfunction join(parts, filename) {\n    return path.resolve(parts.join(path.sep) + path.sep, filename);\n}\n\nfunction loadJSConfigFile(filePath, suppress) {\n    debug(`Loading JS config file: ${filePath}`);\n    try {\n        return requireUncached(filePath);\n    } catch (e) {\n        debug(`Error reading JavaScript file: ${filePath}`);\n        if (!suppress) {\n            e.message = `Cannot read config file: ${filePath}\\nError: ${e.message}`;\n            throw e;\n        }\n    }\n}\n\nfunction loadJSONConfigFile(filePath, suppress) {\n    debug(`Loading JSON config file: ${filePath}`);\n\n    try {\n        return JSON5.parse(readFile(filePath));\n    } catch (e) {\n        debug(`Error reading JSON file: ${filePath}`);\n        if (!suppress) {\n            e.message = `Cannot read config file: ${filePath}\\nError: ${e.message}`;\n            throw e;\n        }\n    }\n}\n\nfunction readFile(filePath) {\n    return fs.readFileSync(filePath, \"utf8\");\n}\n\nfunction loadYAMLConfigFile(filePath, suppress) {\n    debug(`Loading YAML config file: ${filePath}`);\n\n    // lazy load YAML to improve performance when not used\n    const yaml = require(\"js-yaml\");\n\n    try {\n        // empty YAML file can be null, so always use\n        return yaml.safeLoad(readFile(filePath)) || {};\n    } catch (e) {\n        debug(`Error reading YAML file: ${filePath}`);\n        if (!suppress) {\n            e.message = `Cannot read config file: ${filePath}\\nError: ${e.message}`;\n            throw e;\n        }\n    }\n}\n"]}